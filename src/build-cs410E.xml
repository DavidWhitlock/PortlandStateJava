<?xml version="1.0"?>

<!-- Jakarta Ant build file for PSU source code for CS410E -->

<project default="usage" basedir=".">

  <!-- Prints usage information on what to build -->
  <target name="usage">
    <echo message=""/>
    <echo message="Building PSU Java source code:"/>
    <echo message=""/>
    <echo message="Targets are:"/>
    <echo message="  examples    Builds example code"/>
    <echo message="  familyTree  Builds the family tree example code"/>
    <echo message="  docs        Builds the Javadocs for all this code"/>
    <echo message="  clean       Removes all byproducts of building"/>
  </target>

  <!-- Sets up properties used during building -->
  <target name="props">
    <property environment="myenv"/>

    <property name="src.dir" value="."/>
    <property name="jars.dir" value="../jars"/>
    <property name="api.docs.dir" value="../docs"/>
    <property name="classes.dir" value="./classes"/>

    <property name="examples.jar" value="examples.jar"/>
    <property name="familyTree.jar" value="familyTree.jar"/>
    <property name="client.jar" value="client.jar"/>

    <!-- Stuff for Cloudscape -->
    <property name="cloud-lib" value="${myenv.J2EE_HOME}/lib/cloudscape" />
    <property name="system-lib" value="${myenv.J2EE_HOME}/lib/system" />
    <property name="cloud-path" value=".:${cloud-lib}/cloudclient.jar:${cloud-lib}/RmiJdbc.jar:${system-lib}/cloudutil.jar:${system-lib}/cloudscape.jar"/>
    <property name="cloud-jvmargs" value="-Xms16m -Xmx32m -Dij.connection.CloudscapeDB=jdbc:rmi://localhost:1099/jdbc:cloudscape:CloudscapeDB;create=true -Dcloudscape.system.home=${myenv.J2EE_HOME}\cloudscape"/>
  </target>

  <!-- Removes byproducts of building -->
  <target name="clean" depends="props">
    <delete dir="${classes.dir}"/>
    <delete file="${jars.dir}/${client.jar}"/>
    <delete file="${jars.dir}/${examples.jar}"/>
    <delete file="${jars.dir}/${familyTree.jar}"/>
    <delete dir="${api.docs.dir}"/>
  </target>

  <!-- Builds the rmi examples -->
  <target name="rmi" depends="props">
    <mkdir dir="${classes.dir}"/>
    <javac srcdir="${src.dir}"
           destdir="${classes.dir}"
           includes="edu/pdx/cs410E/rmi/**"
           includeAntRuntime="false"
           debug="on">
      <classpath>
        <pathelement location="${jars.dir}/junit.jar"/>
      </classpath>
    </javac>

    <!-- Generate "stubs" for remote classes -->
    <rmic includes=
            "edu/pdx/cs410E/rmi/EquationSolverImpl.class,
             edu/pdx/cs410E/rmi/MovieDatabaseImpl.class"
          classpath="${classes.dir}"
          base="${classes.dir}"/>

    <jar jarfile="${jars.dir}/${examples.jar}"
         update="yes">
      <fileset dir="${classes.dir}">
         <include name="edu/pdx/cs410E/rmi/**"/>
         <!-- Server doesn't need client code -->
         <exclude name="edu/pdx/cs410E/rmi/EquationClient.class"/>
         <exclude name="edu/pdx/cs410E/rmi/CreateMovie.class"/>
         <exclude name="edu/pdx/cs410E/rmi/NoteCharacter.class"/>
         <exclude name="edu/pdx/cs410E/rmi/GetFilmography.class"/>
         <exclude name="edu/pdx/cs410E/rmi/GetMoviesInYear*.class"/>
      </fileset>
    </jar>

    <jar jarfile="${jars.dir}/${client.jar}"
         update="yes">
      <fileset dir="${classes.dir}">
         <include name="edu/pdx/cs410E/rmi/EquationClient.class"/>
         <include name="edu/pdx/cs410E/rmi/EquationSolver.class"/>
         <include name="edu/pdx/cs410E/rmi/Movie.class"/>
         <include name="edu/pdx/cs410E/rmi/MovieDatabase.class"/>
         <include name="edu/pdx/cs410E/rmi/Query.class"/>
         <include name="edu/pdx/cs410E/rmi/CreateMovie.class"/>
         <include name="edu/pdx/cs410E/rmi/NoteCharacter.class"/>
         <include name="edu/pdx/cs410E/rmi/GetFilmography.class"/>
         <include name="edu/pdx/cs410E/rmi/GetMoviesInYear*.class"/>
         <include name="edu/pdx/cs410E/rmi/ShutdownMovieDatabase.class"/>
      </fileset>
    </jar>
  </target>

  <!-- Builds the reflection examples -->
  <target name="reflect" depends="props">
    <mkdir dir="${classes.dir}"/>
    <javac srcdir="${src.dir}"
           destdir="${classes.dir}"
           includes="edu/pdx/cs410E/reflect/**"
           includeAntRuntime="false"
           debug="on"/>
    <copy file="${src.dir}/edu/pdx/cs410E/reflect/doi.txt"
          toDir="${classes.dir}/edu/pdx/cs410E/reflect"/>
    <jar jarfile="${jars.dir}/${examples.jar}"
         basedir="${classes.dir}"
         update="yes"
         includes="edu/pdx/cs410E/reflect/**"/>
  </target>

  <!-- Builds the JDBC examples -->

  <target name="jdbc" depends="props">
    <mkdir dir="${classes.dir}"/>
    <javac srcdir="${src.dir}"
           destdir="${classes.dir}"
           includes="edu/pdx/cs410E/jdbc/**"
           includeAntRuntime="false"
           debug="on"/>
    <jar jarfile="${jars.dir}/${examples.jar}"
         basedir="${classes.dir}"
         update="yes"
         includes="edu/pdx/cs410E/jdbc/**"/>
  </target>

  <target name="run-Student"  depends="jdbc">
  <java classname="edu.pdx.cs410E.jdbc.Student" fork="yes">
    <arg value="001-62-2843"/>
    <classpath>
      <pathelement location="${jars.dir}/examples.jar"/>
      <pathelement path="${cloud-path}"/>
    </classpath>
  </java>
  </target>

  <!-- Populates a Cloudscape database with various pieces of data -->

  <target name="jdbc-populate-cars" depends="props">
  <java classname="COM.cloudscape.tools.ij" fork="yes" >
    <jvmarg line="${cloud-jvmargs}"/>
    <arg value="${src.dir}/edu/pdx/cs410E/jdbc/populate-cars.sql"/>
    <classpath path="${cloud-path}"/>
  </java>
  </target>

  <target name="jdbc-populate-inventory" depends="props">
  <java classname="COM.cloudscape.tools.ij" fork="yes" >
     <jvmarg line="${cloud-jvmargs}"/>
     <arg value="${src.dir}/edu/pdx/cs410E/jdbc/populate-inventory.sql"/>
     <classpath path="${cloud-path}"/>
  </java>
  </target>

  <target name="jdbc-populate-university" depends="props">
  <java classname="COM.cloudscape.tools.ij" fork="yes" >
     <jvmarg line="${cloud-jvmargs}"/>
     <arg value="${src.dir}/edu/pdx/cs410E/jdbc/populate-university.sql"/>
     <classpath path="${cloud-path}"/>
  </java>
  </target>

  <!-- Builds the family tree examples -->

  <target name="familyTree" depends="props">
    <mkdir dir="${classes.dir}"/>
    <javac srcdir="${src.dir}"
           destdir="${classes.dir}"
           includes="edu/pdx/cs410E/familyTree/**"
           includeAntRuntime="false"
           debug="on">
      <classpath>
        <pathelement location="${jars.dir}/junit.jar"/>
      </classpath>
    </javac>

    <!-- Generate "stubs" for remote classes -->
    <rmic includes=
            "edu/pdx/cs410E/familyTree/RemoteMarriageImpl.class,
             edu/pdx/cs410E/familyTree/RemotePersonImpl.class,
             edu/pdx/cs410E/familyTree/XmlRemoteFamilyTree.class"
          classpath="${classes.dir}"
          base="${classes.dir}"/>

    <jar jarfile="${jars.dir}/${familyTree.jar}"
         update="yes">
      <fileset dir="${classes.dir}">
         <include name="edu/pdx/cs410E/familyTree/**"/>
         <!-- Server doesn't need client code -->
         <exclude name="edu/pdx/cs410E/rmi/GetMoviesInYear*.class"/>
      </fileset>
    </jar>

    <jar jarfile="${jars.dir}/${client.jar}"
         update="yes">
      <fileset dir="${classes.dir}">
         <include name="edu/pdx/cs410E/rmi/ShutdownMovieDatabase.class"/>
      </fileset>
    </jar>

  </target>


</project>